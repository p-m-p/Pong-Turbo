var GameItem=function(a,e,d,b){this.x=a;this.y=e;this.w=d;this.h=b};GameItem.prototype.draw=function(a){a.fillRect(this.x,this.y,this.w,this.h)};var Ball=function(){this.dx=arguments[0];this.dy=arguments[1];GameItem.apply(this,Array.prototype.slice.call(arguments,2))};Ball.prototype=new GameItem;Ball.prototype.constructor=Ball; Ball.prototype.move=function(a){if(this.y+this.h>=PONG.canvas.height){if(this.dy=-this.dy,this.x-this.w/2<=0)this.dx=-this.dx}else if(this.y<=0){if(this.dy=-this.dy,this.x-this.w/2<=0)this.dx=-this.dx}else this.x<=0?this.dx=-this.dx:this.hasHitPaddle(a)?PONG.playSound("paddle"):GHOSTS.hasHitGhost(this)?PONG.playSound("ghost"):this.x+this.w>=PONG.canvas.width&&PONG.newRoundOrGameOver();this.x+=this.dx;this.y+=this.dy}; Ball.prototype.resetPosition=function(){this.x=60;this.y=Math.floor((PONG.canvas.height-this.h*2)*Math.random());this.dx=PONG.dt/2;this.dy=PONG.dt/2};Ball.prototype.hasHitPaddle=function(a){if(this.x+this.w+this.dy>=a.x&&this.y>=a.y&&this.y+this.w<=a.y+a.h)return a=Math.abs(Math.round(PONG.dt*Math.random())),a<PONG.dt/2&&(a+=PONG.dt/2),this.dy=this.dy<0?-(PONG.dt-a):PONG.dt-a,this.dx=-a,PONG.player.boostScore("paddle"),!0;return!1};var Paddle=function(){this.moveY=!1;GameItem.apply(this,arguments)};Paddle.prototype=new GameItem;Paddle.prototype.constructor=Paddle;Paddle.prototype.move=function(){var a=1.2*PONG.dt;if(this.moveY)if(this.moveY==="u")this.y-a>=0?this.y-=a:this.y=0;else if(this.moveY==="d")this.y+this.h+a<=PONG.canvas.height?this.y+=a:this.y=PONG.canvas.height-this.h};var Player=function(){this.score=0;this.balls=5;this.level=1};Player.prototype.loseLife=function(){--this.balls};Player.prototype.levelUp=function(){++this.level;this.boostScore("level")};Player.prototype.canContinue=function(){return this.balls>1};Player.prototype.reset=function(){this.balls=5;this.score=0};Player.prototype.boostScore=function(a){switch(a){case "ghost":this.score+=this.level*PONG.dt;break;case "level":this.score+=this.level*1E3;break;case "paddle":this.score+=PONG.dt}PONG.updateScoreboard()};var GHOSTS=function(){var a=[],e=new Image;e.src="images/ghost.png";var d=function(){this.direction="d";this.image=arguments[0];GameItem.apply(this,Array.prototype.slice.call(arguments,1))};d.prototype=new GameItem;d.prototype.constructor=d;d.prototype.draw=function(a){a.drawImage(this.image,this.x,this.y)};d.prototype.move=function(){var a=PONG.dt/4;this.direction==="d"?this.y+this.h+a<=PONG.canvas.height-this.h?this.y+=a:this.direction="u":this.y-a>=0?this.y-=a:this.direction="d"};d.prototype.takeHit= function(){PONG.player.boostScore("ghost");PONG.playSound("ghost")};return{spawnGhosts:function(b){a=[];for(var b=b||5,c=0;c<b;++c)a[c]=new d(e,30,c*80,32,32)},hasHitGhost:function(b){for(var c=0;c<a.length;++c)if(b.x+b.w>=a[c].x&&b.x+b.w<a[c].x+a[c].w&&b.y>=a[c].y&&b.y+b.h<=a[c].y+a[c].h)return a[c].takeHit(),a.splice(c,1),!0;return!1},moveGhosts:function(){for(var b=0;b<a.length;++b)a[b].move()},drawGhosts:function(b){for(var c=0;c<a.length;++c)a[c].draw(b)},allDead:function(){return a.length== 0}}}();var PONG=function(a){var e,d,b={paddle:null,ghost:null,roundEnd:null,levelUp:null},c="mp3",f={lives:null,player:null,score:null};this.load=function(){var a=document.getElementById("soundtrack");if(a.readystate<3)setTimeout(this.load,100);else{var b=document.getElementById("startGame");document.getElementById("loadingMessage").style.display="none";b.style.display="block";b.disabled=!1;b.addEventListener("click",function(){document.getElementById("loading").style.display="none";document.getElementById("game").style.display= "block";a.play();g();this.blur()},!1);b.focus()}};this.init=function(){var a=document.getElementById("gameSounds");~navigator.userAgent.toLowerCase().search("firefox")&&(c="ogg");for(var e in b)b[e]=document.createElement("audio"),b[e].src="sound/"+c+"/"+e+"."+c,a.appendChild(b[e]);document.getElementById("toggleSound").addEventListener("click",h,!1);this.canvas=document.getElementById("pongBoard");this.context=this.canvas.getContext("2d");this.player=new Player;f.balls=document.querySelectorAll(".ball"); f.score=document.getElementById("playerscore");f.level=document.getElementById("playerlevel");window.addEventListener("keydown",function(a){a.keyCode===38||a.keyCode===104?paddle.moveY="u":a.keyCode===40||a.keyCode===98?paddle.moveY="d":!d&&a.target.id!=="startGame"&&a.keyCode===13&&g.call(PONG)},!1);window.addEventListener("keyup",function(){paddle.moveY=!1},!1);this.load()};var g=function(){for(var b=0;b<f.balls.length;++b)f.balls[b].className="ball";this.canvas.width=this.canvas.width;this.dt= 16;paddle=new Paddle(this.canvas.width-15,this.canvas.height/2-20,10,60);e=new Ball(this.dt/2,this.dt/2,60,20,10,10);this.player.reset();this.updateScoreboard();d=setInterval(i,1E3/30);a.spawnGhosts()};this.newRoundOrGameOver=function(){this.player.canContinue()?(e.resetPosition(),this.playSound("roundEnd")):(d=clearInterval(d),this.canvas.width=this.canvas.width,this.context.fillStyle="orange",this.context.font="bold 14px Arial",this.context.fillText("Game over! Hit enter to play again",this.canvas.width/ 2-110,this.canvas.height/2-7));this.loseBall()};var i=function(){e.move(paddle);paddle.move();a.allDead()?(this.dt+=2,this.player.levelUp(),this.playSound("levelUp"),a.spawnGhosts()):a.moveGhosts();j()},j=function(){if(d)this.canvas.width=this.canvas.width,this.context.fillStyle="orange",e.draw(this.context),paddle.draw(this.context),a.drawGhosts(this.context)},h=function(){var a=document.getElementById("soundtrack");a.muted?(a.muted=!1,this.className=""):(a.muted=!0,this.className="muted");this.blur()}; this.updateScoreboard=function(){f.score.textContent=this.player.score};this.playSound=function(a){b[a].play()};this.loseBall=function(){f.balls[this.player.balls-1].className="ball dead";this.player.loseLife()};return this}(GHOSTS);window.onload=function(){PONG.init()};